<UserControl x:Class="_1RM.View.Editor.Forms.VncFormView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:controls="clr-namespace:Shawn.Utils.Wpf.Controls;assembly=Shawn.Utils.Wpf"
             xmlns:controls1="clr-namespace:_1RM.Controls"
             xmlns:forms="clr-namespace:_1RM.View.Editor.Forms"
             xmlns:local="clr-namespace:_1RM.View.Editor.Forms"
             xmlns:s="https://github.com/canton7/Stylet"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance forms:VncFormViewModel}"
             d:DesignHeight="1450" d:DesignWidth="800">
    <UserControl.Resources>
        <!-- VNC Window Resize Mode Converter -->
        <local:ConverterEVncWindowResizeMode x:Key="ConverterEVncWindowResizeMode" />
    </UserControl.Resources>
    <StackPanel>
        <!-- 连接信息卡片 (现在包含在HostView中) -->
        <ContentControl s:View.Model="{Binding HostViewModel}"></ContentControl>

        <!-- VNC认证设置 -->
        <StackPanel>
            <!-- 认证信息内容 -->
            <Border Margin="0,0,0,12">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" MinWidth="120"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" Text="认证信息"
                               VerticalAlignment="Center"
                               FontSize="13" FontWeight="Medium"
                               Foreground="{DynamicResource PrimaryTextBrush}"/>

                    <ContentControl Grid.Column="1"
                                    s:View.Model="{Binding CredentialViewModel}"
                                    Margin="15,0,0,0"/>
                </Grid>
            </Border>

            <!-- Separator -->
            <Border Height="1" Background="{DynamicResource PrimaryMidBrush}" Opacity="0.3" Margin="0,0,0,12"/>
        </StackPanel>

        <!-- 备选认证 -->
        <ContentControl s:View.Model="{Binding AlternativeCredentialListViewModel}">
            <ContentControl.Style>
                <Style TargetType="ContentControl">
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding AlternativeCredentialListViewModel.Credentials.Count}" Value="0">
                            <Setter Property="Visibility" Value="Collapsed"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </ContentControl.Style>
        </ContentControl>

        <!-- VNC高级设置 -->
        <StackPanel>
            <!-- 分辨率设置 -->
            <Border Margin="0,0,0,12">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" MinWidth="120"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" Text="{DynamicResource Resolution}"
                               VerticalAlignment="Center"
                               FontSize="13" FontWeight="Medium"
                               Foreground="{DynamicResource PrimaryTextBrush}"/>

                    <ComboBox Grid.Column="1"
                              Name="ComboBoxResolution"
                              SelectedIndex="{Binding New.VncWindowResizeMode, Converter={StaticResource ConverterEVncWindowResizeMode}}"
                              Height="28"
                              VerticalAlignment="Center"
                              Margin="15,0,0,0">
                        <ComboBox.Style>
                            <Style TargetType="ComboBox" BasedOn="{StaticResource {x:Type ComboBox}}">
                                <Setter Property="Height" Value="28"/>
                                <Setter Property="Padding" Value="8,6"/>
                                <Setter Property="FontSize" Value="12"/>
                                <Setter Property="BorderBrush" Value="{DynamicResource PrimaryMidBrush}"/>
                                <Setter Property="BorderThickness" Value="1"/>
                                <Setter Property="Background" Value="{DynamicResource BackgroundBrush}"/>
                            </Style>
                        </ComboBox.Style>
                        <ComboBoxItem Content="{DynamicResource 'Custom resolution (stretch)'}" />
                        <ComboBoxItem Content="{DynamicResource 'Custom resolution (fixed)'}" />
                        <ComboBoxItem Visibility="{Binding New.VncWindowResizeMode, Converter={StaticResource ConverterEqual2Visible}, ConverterParameter={x:Null}}" Content="{Binding New.ServerEditorDifferentOptions}" />
                    </ComboBox>
                </Grid>
            </Border>

            <!-- 警告信息 -->
            <Border Margin="0,0,0,12"
                    Background="{DynamicResource AccentLightBrush}"
                    CornerRadius="4"
                    Padding="12,8"
                    BorderThickness="1"
                    BorderBrush="{DynamicResource AccentMidBrush}">
                <StackPanel>
                    <TextBlock TextWrapping="Wrap"
                               FontSize="12"
                               Foreground="{DynamicResource BackgroundTextBrush}">
                        <Run Text="⚠️ 注意：RFB 3.8+ 协议为专有协议。如需使用 RFB 3.8+，请尝试使用自定义 VNC 运行器：" />
                        <LineBreak/>
                        <Hyperlink NavigateUri="https://1remote.github.io/usage/protocol/runner/"
                                    TextDecorations="{x:Null}"
                                    controls:HyperlinkHelper.IsOpenExternal="True"
                                    Foreground="{DynamicResource AccentMidBrush}">
                            <Run Text="[更多详情]" />
                        </Hyperlink>
                    </TextBlock>
                </StackPanel>
            </Border>
        </StackPanel>
    </StackPanel>
</UserControl>